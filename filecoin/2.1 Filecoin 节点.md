### 2.1 Filecoin 节点

TODO 说明

#### 节点类型

filecoin的节点由其所能提供的服务来定义。节点的基础服务包括：

- 链验证服务
- 存储市场的交互服务
- 检索市场的交互服务
- 挖矿（证明存力）

任何参与filecoin网络的节点所必须提供的最少服务应该包括链验证的服务。再此之上提供的任何其他的服务，我们可以将其划分为不同类型的节点。

> Nodes can be realized with a repository (directory) in the host in a one-to-one relationship - that is, one repo belongs to a single node. That said, one host can implement multiple Filecoin nodes by having the corresponding repositories.

这里原文大意是说，不同的节点可以通过一对一的仓库（文件）来实现，也就是说一台机器上（host）可以实现多种类型的filecoin节点。

对应的节点实现，或是说filecoin的子系统、节点类型包括如下几种：‌

- 链验证器节点：参与filecoin网络的所需要提供的最少服务功能。该类型节点cannot play an active role in the network（这个我也不知道该翻译成啥，似乎可以翻译成“不参与记账“，毕竟有没有他都是一样的，使用场景是说，我可以通过该节点验证一笔交易的合法性），除非其实现客户端节点（如下）功能。链验证器节点在参与之初需同步至当前全网状态所达成的共识。此后，节点将参与接收新的块，并验证其合法性。
- 客户端节点：客户端节点构建在链验证器节点之上，filecoin网络上所有应用必须依赖的该类型节点。可以将其理解为在filecoin上构建去中心化存储或其他应用的基础设施。该节点也应实现存储和检索市场的服务以达到与可以通过存储、检索市场进行数据交互的功能。
- 检索矿工节点：同样构建在链验证器节点之上，检索矿工节点通过实现检索功能，提供数据的检索、传输服务。
- 存储矿工节点：该节点参与链的维护，实现链验证、挖矿、存储市场等功能。

#### 接口声明

- 节点的接口声明：[repo](https://github.com/filecoin-project/lotus/blob/master/node/repo/interface.go)

- 链验证器节点

  ```go
  type ChainVerifierNode interface {
    FilecoinNode
  
    systems.Blockchain
  }
  ```

  对应的lotus接口声明：[full node](https://github.com/filecoin-project/lotus/blob/master/node/impl/full.go)

- 客户端节点

  ```go
  type ClientNode struct {
    FilecoinNode
  
    systems.Blockchain
    markets.StorageMarketClient
    markets.RetrievalMarketClient
    markets.DataTransfers
  }
  ```

  对应的lotus接口声明： [client](https://github.com/filecoin-project/lotus/blob/master/node/impl/client/client.go)

- 检索矿工节点

  ```go
  type RetrievalMinerNode interface {
    FilecoinNode
  
    blockchain.Blockchain
    markets.RetrievalMarketProvider
    markets.DataTransfers
  }
  ```

  TODO 这里的接口声明呢

- 存储矿工节点

  ```go
  type StorageMinerNode interface {
    FilecoinNode
  
    systems.Blockchain
    systems.Mining
    markets.StorageMarketProvider
    markets.DataTransfers
  }
  ```

  对应的lotus接口声明：[storminer](https://github.com/filecoin-project/lotus/blob/master/node/impl/storminer.go)

- 中继节点

  ```go
  type RelayerNode interface {
    FilecoinNode
  
    blockchain.MessagePool
  }
  ```

- 节点的相关配置声明： [def](https://github.com/filecoin-project/lotus/blob/master/node/config/def.go)

#### 节点仓库

为了使节点正常运行，我们在本地抽象了节点仓库的概念，存储了系统所需要的数据，如链数据等。该仓库可在node与node或其他子系统之间互相访问，与节点本身的 FileStore 相隔离。节点的相关状态配置信息以及节点的一系列keys以IPLD数据类型存储。相关声明参考： [fsrepo](https://github.com/filecoin-project/lotus/blob/master/node/repo/fsrepo.go)

##### Key Store

在任何节点上，我们需要对矿工和其名下所有工作的worker做标识，Key Store 是一种抽象的概念，旨在存储所有的keypairs（密钥对？）

对密钥的安全存储我们有如下建议：

- 密钥独立在每个子系统之外
- 在子系统需要时使用一个独立的密钥对信息进行签名
- 对密钥进行冷存储

存储矿工依赖三个核心组件：

- The storage miner actor address  f0开头的那个，创建矿工的时候生成，和钱包关联
- The owner keypair  和公钥相关联，一般为钱包地址，出块奖励或是其他交易会用此地址 ownerAddress
- The worker keypair 公钥与存储矿工关联的地址，可以通过矿工进行更改，用以对交易等信息进行签名，必须是BLS keypair，并作为VRF的一部分

一个owner可以创建多个miner，多个worker

修改worker的keypairs需要通过链，需要两个步骤：

Note that this is a two-step process. First, a miner stages a change by sending a message to the chain. When received, the key change is staged to occur in twice the randomness lookback parameter number of epochs, to prevent adaptive key selection attacks. Every time a worker key is queried, a pending change is lazily checked and state is potentially updated as needed.

和其他多数区块链系统一样，密钥的安全性至关重要，其直接关联了账户资金

##### IPLD

InterPlanetary Linked Data (IPLD)是一组对内容寻址通用格式的抽象描述。使用该数据类型能为通过哈希类型检索的数据提供一个通用的数据模型。

filecoin 节点是本地存储的哈希链接。

IPLD主要由三层组成

- the Block Layer 关注区块格式和地址，区块如何声明自身的编码方式
- the Data Model Layer 定义一系列需要实现的类型（Todo）
- the Schema Layer